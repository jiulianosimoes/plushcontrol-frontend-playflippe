<!DOCTYPE html>
<html lang="pt-br">

<head>
<meta charset="UTF-8" />
<title>M√°quinas PlayFlippe</title>

<style>
body {
  font-family: Arial;
  padding: 40px;
  background: #f5f5f5;
}

input, select, button {
  padding: 8px;
  margin-right: 5px;
}

table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 20px;
  background: white;
}

th, td {
  padding: 10px;
  border: 1px solid #ddd;
}

th {
  background: #222;
  color: white;
}

.acoes button {
  margin-right: 5px;
}

.filtros {
  margin-top: 15px;
}
</style>
</head>


<body>

<h2>M√°quinas PlayFlippe</h2>

<!-- CADASTRO -->
<input id="nome" placeholder="Nome da m√°quina" />
<input id="status" placeholder="Status (Ativa/Manuten√ß√£o)" />
<button onclick="adicionar()">Adicionar</button>


<!-- üî• FILTROS -->
<div class="filtros">
  <input
    id="buscaNome"
    placeholder="Buscar por nome..."
    oninput="filtrar()"
  />

  <select id="filtroStatus" onchange="filtrar()">
    <option value="">Todos status</option>
    <option value="Ativa">Ativa</option>
    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
  </select>
</div>


<!-- TABELA -->
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Nome</th>
      <th>Status</th>
      <th>A√ß√µes</th>
    </tr>
  </thead>

  <tbody id="lista"></tbody>
</table>



<script>
const API = "https://plushcontrol-playflippe-production.up.railway.app/maquinas"

let dadosOriginais = []


/* ===============================
   CARREGAR DADOS
================================*/
async function carregar() {
  const res = await fetch(API)
  dadosOriginais = await res.json()
  renderizar(dadosOriginais)
}


/* ===============================
   RENDERIZA TABELA
================================*/
function renderizar(lista) {
  const tbody = document.getElementById("lista")
  tbody.innerHTML = ""

  lista.forEach(m => {
    tbody.innerHTML += `
      <tr>
        <td>${m.id}</td>
        <td>${m.nome}</td>
        <td>${m.status}</td>
        <td class="acoes">
          <button onclick="editar(${m.id}, '${m.nome}', '${m.status}')">Editar</button>
          <button onclick="excluir(${m.id})">Excluir</button>
        </td>
      </tr>
    `
  })
}


/* ===============================
   FILTRO POR NOME + STATUS
================================*/
function filtrar() {
  const nomeBusca = document
    .getElementById("buscaNome")
    .value
    .toLowerCase()

  const statusFiltro = document
    .getElementById("filtroStatus")
    .value

  const filtrado = dadosOriginais.filter(m =>
    m.nome.toLowerCase().includes(nomeBusca) &&
    (statusFiltro === "" || m.status === statusFiltro)
  )

  renderizar(filtrado)
}


/* ===============================
   ADICIONAR
================================*/
async function adicionar() {
  const nome = document.getElementById("nome").value
  const status = document.getElementById("status").value

  await fetch(API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nome, status })
  })

  carregar()
}


/* ===============================
   EXCLUIR
================================*/
async function excluir(id) {
  await fetch(API + "/" + id, { method: "DELETE" })
  carregar()
}


/* ===============================
   EDITAR
================================*/
async function editar(id, nomeAtual, statusAtual) {
  const nome = prompt("Novo nome:", nomeAtual)
  const status = prompt("Novo status:", statusAtual)

  if (!nome || !status) return

  await fetch(API + "/" + id, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nome, status })
  })

  carregar()
}


/* START */
carregar()
</script>

</body>
</html>
